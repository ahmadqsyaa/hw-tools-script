#!/bin/bash

#do not modify this file if you do not understand it
#create https://github.com/ahmadqsyaa

ipmodem="192.168.8.1"
pass="admin123"

if [[ -n "$(opkg list-installed | grep -E 'libxml2|bash|curl')" ]]; then

login(){
data=$(curl -s http://$ipmodem/api/webserver/SesTokInfo -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7")
sesi=$(echo "$data" | grep "SessionID=" | cut -b 10-147)
token=$(echo "$data" | grep "TokInfo" | cut -b 10-41)
check=$(curl -s http://$ipmodem/api/user/state-login -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
state=$(echo $check|awk -F "<State>" '{print $2}'|awk -F "</State>" '{print $1}')
type=$(echo $check|awk -F "<password_type>" '{print $2}'|awk -F "</password_type>" '{print $1}')
if [ $state = "0" ]; then
  echo "Activated Successfully";
else
  if [ $type = "4" ]; then
    pass1=$(echo -n "$pass"|sha256sum|head -c 64|base64 -w 0)
    pass1=$(echo -n "admin$pass1$token"|sha256sum|head -c 64|base64 -w 0)
    pass1=$(echo -n "$pass1</Password><password_type>4</password_type>")
  else
    pass1=$(echo -n "$pass"|base64 -w 0)
    pass1=$(echo -n "$pass1</Password>")
  fi
  login=$(curl -s -D- -o/dev/null -X POST http://$ipmodem/api/user/login -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><Username>admin</Username><Password>'$pass1'</request>')
  scoki=$(echo "$login"|grep [Ss]et-[Cc]ookie|cut -d':' -f2|cut -b 1-138)
  if [ ! -n "$scoki" ]; then
  echo -e "\e[31mLogin failed, please enter the IP address and password\e[0m"
  read -r -p "enter the IP address or [Y/y] default 192.168.8.1 =>" ipads
      if [[ "$ipads" =~ ^([yY][eE][sS]|[yY])$ ]]; then
       echo -e "ip default: \e[36m192.168.8.1\e[0m"
      elif [ ! -n "$ipads" ]; then
       echo -e "\e[41m input should not be empty\e[0m"
       exit 1
      else
       sed -i "6s/.*/ipmodem=\"$ipads\"/" /usr/bin/ht
       echo -e "\e[42msuccess\e[0m"
      fi
  read -r -p "Enter the modem password or [Y/y] default admin =>" pswd
      if [[ "$pswd" =~ ^([yY][eE][sS]|[yY])$ ]]; then
       echo -e "password default: \e[36madmin\e[0m"
      elif [ ! -n "$ipads" ]; then
       echo -e "\e[41m input should not be empty\e[0m"
       exit 1
      else
       sed -i "7s/.*/pass=\"$pswd\"/" /usr/bin/ht
       echo -e "\e[42msuccess\e[0m"
      fi
  usage
  fi
fi
}
choki(){
 data=$(curl -s http://$ipmodem/api/webserver/SesTokInfo -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $scoki")
 sesi=$(echo "$data" | grep "SessionID=" | cut -b 10-147)
 token=$(echo "$data" | grep "TokInfo" | cut -b 10-41)
}

function reboot() {
 login
 choki
 res=$(curl -s -X POST http://$ipmodem/api/device/control -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><Control>1</Control></request>')
 ress=$(echo $res|awk -F "<response>" '{print $2}'|awk -F "</response>" '{print $1}')
 if [ "$ress" = "OK" ]; then
   echo -e "\e[42mrebooting...\e[0m"
 else
   echo -e "\e[41mfailed rebooting\e[0m"
 fi
}

function getSMS(){
login
choki
 if [ -n "${1}" ]; then
 cn=$1
 get=$(curl -s -X POST http://$ipmodem/api/sms/sms-list -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><PageIndex>1</PageIndex><ReadCount>'"$cn"'</ReadCount><BoxType>1</BoxType><SortType>0</SortType><Ascending>0</Ascending><UnreadPreferred>true</UnreadPreferred></request>')
 format=$(echo "$get" | xmllint --format -)
 echo "$get" | xmllint --format -
 else
 cnn=$(curl -s -X GET http://$ipmodem/api/sms/sms-count -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 cn=$(echo $cnn|awk -F "<LocalInbox>" '{print $2}'|awk -F "</LocalInbox>" '{print $1}')
 get=$(curl -s -X POST http://$ipmodem/api/sms/sms-list -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><PageIndex>1</PageIndex><ReadCount>'"$cn"'</ReadCount><BoxType>1</BoxType><SortType>0</SortType><Ascending>0</Ascending><UnreadPreferred>true</UnreadPreferred></request>')
 echo "$get" | xmllint --format -
 fi
}


function sendSMS(){
login
 to="${1}"
    if [[ ! "$to" =~ ^\+?[0-9]+$ ]]; then
        echo "Please provide the receiver number (08xxxx or +628xxx)"
        exit 1
    fi
    message="${@:2}"
    if [ -z "$message" ]; then
        echo "Please provide the message"
        exit 1
    fi
 choki
 dates=$(date +"%Y-%m-%d %H:%M:%S")
 lengh=$(echo -n "$message" | wc -c)
 send=$(curl -s -X POST http://$ipmodem/api/sms/send-sms -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><Index>-1</Index><Phones><Phone>'"$to"'</Phone></Phones><Sca></Sca><Content>'"$message"'</Content><Length>'"$lengh"'</Length><Reserved>1</Reserved><Date>$dates</Date></request>')
 sendd=$(echo $send|awk -F "<response>" '{print $2}'|awk -F "</response>" '{print $1}')
 #echo $sendd
 if [ "$sendd" = "OK" ]; then
   echo -e "\e[42msuccess\e[0m"
 else
   echo -e "\e[41mfailed\e[0m"
 fi
}


function deletedSMS(){
login
 if [ -n "${1}" ]; then
 choki
 del=$(curl -s -X POST http://$ipmodem/api/sms/delete-sms -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><Index>'"$1"'</Index></request>')
 #echo $sendd

 dell=$(echo $del|awk -F "<response>" '{print $2}'|awk -F "</response>" '{print $1}')
    if [ "$dell" = "OK" ]; then
      echo -e "\e[42msuccess\e[0m"
    else
      echo -e "\e[41mfailed\e[0m"
    fi
 else
 echo -e "\e[41mid require!\e[0m"
 fi
}


function countSMS(){
login
choki
 count=$(curl -s -X GET http://$ipmodem/api/sms/sms-count -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 unread=$(echo $count|awk -F "<LocalUnread>" '{print $2}'|awk -F "</LocalUnread>" '{print $1}')
 inbox=$(echo $count|awk -F "<LocalInbox>" '{print $2}'|awk -F "</LocalInbox>" '{print $1}')
 outbox=$(echo $count|awk -F "<LocalOutbox>" '{print $2}'|awk -F "</LocalOutbox>" '{print $1}')
 draf=$(echo $count|awk -F "<LocalDraft>" '{print $2}'|awk -F "</LocalDraft>" '{print $1}')
 deleted=$(echo $count|awk -F "<LocalDeleted>" '{print $2}'|awk -F "</LocalDeleted>" '{print $1}')
 echo "=========="
 echo "unread > $unread"
 echo "inbox > $inbox"
 echo "outbox > $outbox"
 echo "draf > $draf"
 echo "deleted > $deleted"
 echo "=========="
}


function readSMS(){
login
choki
 if [ -n "${1}" ]; then
 read=$(curl -s -X POST http://$ipmodem/api/sms/set-read -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><Index>'"$1"'</Index></request>')
 #echo $read
 readd=$(echo $read|awk -F "<response>" '{print $2}'|awk -F "</response>" '{print $1}')
    if [ "$readd" = "OK" ]; then
      echo -e "\e[42msuccess\e[0m"
    else
      echo -e "\e[41mfailed\e[0m"
    fi
 else
 echo -e "\e[41mid reuire!\e[0m"
 fi
}


function dataSET(){
login
choki
 if [ -n "${1}" ]; then
 set=$(curl -s -X POST http://$ipmodem/api/dialup/mobile-dataswitch -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi" -d '<?xml version="1.0" encoding="UTF-8"?><request><dataswitch>'"$1"'</dataswitch></request>')
 #echo $set
 sett=$(echo $set|awk -F "<response>" '{print $2}'|awk -F "</response>" '{print $1}')
   if [ "$sett" = "OK" ]; then
      echo -e "\e[42msuccess\e[0m"
   else
      echo -e "\e[41mfailed\e[0m"
   fi
 else
 echo -e "\e[47m1 enable or 0 disable\e[0m"
 fi
}


function dataSTATUS(){
login
choki
 datas=$(curl -s -X GET http://$ipmodem/api/dialup/mobile-dataswitch -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 #echo $datas
 datass=$(echo $datas|awk -F "<dataswitch>" '{print $2}'|awk -F "</dataswitch>" '{print $1}')
 #echo $datass
   if [ "$datass" == 1 ]; then
      echo -e "\e[42mdata enable\e[0m"
    else
     echo -e "\e[42mdata disable\e[0m"
    fi
}


# info modem
human_print(){
while read B dummy; do
  [ $B -lt 1024 ] && echo ${B} B && break
  KB=$(((B+512)/1024))
  [ $KB -lt 1024 ] && echo ${KB} KB && break
  MB=$(((KB+512)/1024))
  [ $MB -lt 1024 ] && echo ${MB} MB && break
  GB=$(((MB+512)/1024))
  [ $GB -lt 1024 ] && echo ${GB} GB && break
  echo $(((GB+512)/1024)) terabytes
done
}
bands() {
case $1 in
    "1")
    echo -e '2100 MHz'
    ;;
    "3")
    echo -e '1800 MHz'
    ;;
    "8")
    echo -e '900 MHz'
    ;;
    "40")
    echo -e '2300 MHz'
    ;;
    esac
}
network() {
case $1 in
  "0")
  echo -e 'No service'
  ;;
  "1")
  echo -e 'GSM (2G)'
  ;;
  "2")
  echo -e 'GPRS (2G)'
  ;;
  "3")
  echo -e 'EDGE (2G)'
  ;;
  "21")
  echo -e 'IS95A'
  ;;
  "22")
  echo -e 'IS95B'
  ;;
  "23")
  echo -e 'CDMA 1X'
  ;;
  "24")
  echo -e 'EVDO rev.0'
  ;;
  "25")
  echo -e 'EVDO rev.A'
  ;;
  "26")
  echo -e 'EVDO rev.B'
  ;;
  "27")
  echo -e 'HYBRID CDMA 1X'
  ;;
  "28")
  echo -e 'HYBRID EVDO rev.0'
  ;;
  "29")
  echo -e 'HYBRID EVDO rev.A'
  ;;
  "30")
  echo -e 'HYBRID EVDO rev.B'
  ;;
  "31")
  echo -e 'eHRPD rel.0'
  ;;
  "32")
  echo -e 'eHRPD rel.A'
  ;;
  "33")
  echo -e 'eHRPD rel.B'
  ;;
  "34")
  echo -e 'HYBRID eHRPD rel.0'
  ;;
  "35")
  echo -e 'HYBRID eHRPD rel.A'
  ;;
  "36")
  echo -e 'HYBRID eHRPD rel.B'
  ;;
  "41")
  echo -e 'UMTS (3G)'
  ;;
  "42")
  echo -e 'HSDPA (3G)'
  ;;
  "43")
  echo -e 'HSUPA (3G)'
  ;;
  "44")
  echo -e 'HSPA (3G)'
  ;;
  "45")
  echo -e 'HSPA+ (3.5G)'
  ;;
  "46")
  echo -e 'DC-HSPA+ (3.5G)'
  ;;
  "61")
  echo -e 'TD-SCDMA (3G)'
  ;;
  "62")
  echo -e 'TD-HSDPA (3G)'
  ;;
  "63")
  echo -e 'TD-HSUPA (3G)'
  ;;
  "64")
  echo -e 'TD-HSPA (3G)'
  ;;
  "65")
  echo -e 'TD-HSPA+ (3.5G)'
  ;;
  "81")
  echo -e '802.16E'
  ;;
  "101")
  echo -e 'LTE (4G)'
  ;;
  "1011")
  echo -e 'LTE CA (4G+)'
  ;;
  "111")
  echo -e 'NR (5G)'
  ;;
esac
}


function info(){
 login
 choki
 oper=$(curl -s http://$ipmodem/api/net/current-plmn -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 operator=$(echo $oper|awk -F "<FullName>" '{print $2}'|awk -F "</FullName>" '{print $1}')
 ip=$(curl -s http://$ipmodem/api/device/information -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 ipp=$(echo $ip|awk -F "<WanIPAddress>" '{print $2}'|awk -F "</WanIPAddress>" '{print $1}')
 tp=$(echo $ip|awk -F "<DeviceName>" '{print $2}'|awk -F "</DeviceName>" '{print $1}')
 dns=$(curl -s http://$ipmodem/api/monitoring/status -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 dns1=$(echo $dns|awk -F "<PrimaryDns>" '{print $2}'|awk -F "</PrimaryDns>" '{print $1}')
 dns2=$(echo $dns|awk -F "<SecondaryDns>" '{print $2}'|awk -F "</SecondaryDns>" '{print $1}')
 net=$(echo $dns|awk -F "<CurrentNetworkTypeEx>" '{print $2}'|awk -F "</CurrentNetworkTypeEx>" '{print $1}')
 td=$(curl -s http://$ipmodem/api/monitoring/traffic-statistics -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 tup=$(echo $td|awk -F "<TotalUpload>" '{print $2}'|awk -F "</TotalUpload>" '{print $1}'|human_print)
 tdd=$(echo $td|awk -F "<TotalDownload>" '{print $2}'|awk -F "</TotalDownload>" '{print $1}'|human_print)
 par=$(curl -s http://$ipmodem/config/deviceinformation/add_param.xml -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 band=$(echo $par|awk -F "<band>" '{print $2}'|awk -F "</band>" '{print $1}')
 dlfreq=$(echo $par|awk -F "<freq1>" '{print $2}'|awk -F "</freq1>" '{print $1}')
 upfreq=$(echo $par|awk -F "<freq2>" '{print $2}'|awk -F "</freq2>" '{print $1}')
 dvi=$(curl -s http://$ipmodem/api/device/signal -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "X-Requested-With: XMLHttpRequest" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 pci=$(echo $dvi|awk -F "<pci>" '{print $2}'|awk -F "</pci>" '{print $1}')
 cellid=$(echo $dvi|awk -F "<cell_id>" '{print $2}'|awk -F "</cell_id>" '{print $1}')
 rsrp=$(echo $dvi|awk -F "<rsrp>" '{print $2}'|awk -F "</rsrp>" '{print $1}')
 rssi=$(echo $dvi|awk -F "<rssi>" '{print $2}'|awk -F "</rssi>" '{print $1}')
 rsrq=$(echo $dvi|awk -F "<rsrq>" '{print $2}'|awk -F "</rsrq>" '{print $1}')
 sinr=$(echo $dvi|awk -F "<sinr>" '{print $2}'|awk -F "</sinr>" '{print $1}')
}


function usage(){
 info
 echo "╔════════❖══════════❖════════╗"
 echo -e "|   \e[42mHuawei Tools Script v1.0\e[0m  |"
 echo "|  Created by Rick Qsyaerick  |"
 echo "╚════════❖═════|════❖════════╝"
 echo "╔════════❖═════|════❖════════╗"
 echo -e "➥ 𝙾𝚙𝚎𝚛𝚊𝚝𝚘𝚛 : \e[1;34m$operator\e[0m"
 echo -e "➥ 𝙳𝚎𝚟𝚒𝚌𝚎 : \e[1;34m$tp\e[0m"
 echo -e "➥ 𝚆𝚊𝚗 𝙸𝙿 : \e[31m$ipp\e[0m"
 echo "╚════════❖═════|════❖════════╝"
 echo "╔════════════════════❖═══════════════════❖══════════════════════╗"
 echo "|                          < USAGE >                             | "
 echo "| -r get all sms or get sms with count => ht -r 1                | "
 echo "| -s send sms with the format => ht -s [number] [message]        | "
 echo "| -d deleted sms with id => ht -d 1000                           | "
 echo "| -c view the conten of sms inbox, outbox, unread etc            | "
 echo "| -b change the status of unread to read with id => ht -b 1      | "
 echo "| -m change mobile data =>ht -m [0/1] 0 = OFF 1 = ON             | "
 echo "| -ms view the mobile data status                                | "
 echo "| -o reboot the modem                                            | "
 echo "| -i network information & modem information                     | "
 echo "| -a renew wan ip address                                        | "
 echo "╚════════════════════❖═══════════════════❖══════════════════════╝"
}

function informasi(){
 info
 echo "╔════════❖══════════❖════════╗"
 echo "➥ 𝙾𝚙𝚎𝚛𝚊𝚝𝚘𝚛 : $operator"
 echo "➥ 𝙳𝚎𝚟𝚒𝚌𝚎 : $tp"
 echo "➥ 𝚆𝚊𝚗 𝙸𝙿 : $ipp"
 echo "➥ 𝙳𝙽𝚂 1 : $dns1"
 echo "➥ 𝙳𝙽𝚂 2 : $dns2"
 echo "➥ $(echo -ne "𝙽𝚎𝚝𝚠𝚘𝚛𝚔 : ";network $net)"
 echo "➥ 𝚃𝚘𝚝𝚊𝚕 𝚄𝚙𝚕𝚘𝚊𝚍 : $tup"
 echo "➥ 𝚃𝚘𝚝𝚊𝚕 𝙳𝚘𝚠𝚗𝚕𝚘𝚊𝚍 : $tdd"
 echo "➥ $(echo -ne "𝙱𝚊𝚗𝚍 : ";bands $band;) $(echo -ne "("$band")")"
 echo "➥ 𝙿𝙲𝙸 : $pci"
 echo "➥ 𝙲𝚎𝚕𝚕 𝙸𝙳 : $cellid"
 echo "➥ 𝙳𝙻 𝙵𝚛𝚎𝚚𝚞𝚎𝚗𝚌𝚢 : $dlfreq"
 echo "➥ 𝚄𝙿 𝙵𝚛𝚎𝚚𝚞𝚎𝚗𝚌𝚢 : $upfreq"
 echo "➥ 𝚁𝚜𝚛𝚙 : $rsrp"
 echo "➥ 𝚁𝚜𝚜𝚒 : $rssi"
 echo "➥ 𝚁𝚜𝚛𝚚 : $rsrq"
 echo "➥ 𝚂𝚒𝚗𝚛 : $sinr"
 echo "╚════════❖══════════❖════════╝"
}

function restart(){
 choki
 info
 echo -e "\e[41mbefore: WAN IP: $ipp\e[0m"
 res=$(curl -s -X GET http://$ipmodem/api/net/plmn-list -H "Host: $ipmodem" -H "Connection: keep-alive" -H "Accept: */*" -H "Origin: http://$ipmodem" -H "X-Requested-With: XMLHttpRequest" -H "__RequestVerificationToken: $token" -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36" -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Referer: http://$ipmodem/html/home.html" -H "Accept-Encoding: gzib, deflate" -H "Accept-Language: id-ID,id;q=0.9,en-US;q=0.8,en;q=0.7" -H "Cookie: $sesi")
 #echo $res
 if [ -n "$res" ]; then
 sleep 5
 info
 echo -e "\e[42mafter: WAN IP: $ipp\e[0m"
 fi
}

# end info modem

case "${1}" in
    -r)
        shift
        getSMS "${1}"
        ;;
    -s)
        shift
        sendSMS "${@}"
        ;;
    -d)
        shift
        deleteSMS "${1}"
        ;;
    -c)
        countSMS
        ;;
    -b)
        shift
        readSMS "${1}"
        ;;
    -m)
        shift
        dataSET "${1}"
        ;;
    -ms)
        dataSTATUS
        ;;
    -o)
        reboot
        ;;
    -i)
        informasi
        ;;
    -a)
        restart
        ;;
    *)
      usage
      ;;
esac
else
    echo "package libxml2/bash/curl is not installed."
    sleep 1
    echo "wait installing package.."
    opkg update && opkg install libxml2 libxml2-utils bash curl
    opkg list-installed | grep -E 'libxml2|bash|curl'
    sleep 1
    usage
fi